!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.BiteMe=e():t.BiteMe=e()}(self,(function(){return(()=>{"use strict";var t={d:(e,i)=>{for(var o in i)t.o(i,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:i[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{SnakeWorker:()=>x});const i=Symbol("Comlink.proxy"),o=Symbol("Comlink.endpoint"),r=Symbol("Comlink.releaseProxy"),a=Symbol("Comlink.thrown"),s=t=>"object"==typeof t&&null!==t||"function"==typeof t,n=new Map([["proxy",{canHandle:t=>s(t)&&t[i],serialize(t){const{port1:e,port2:i}=new MessageChannel;return l(t,e),[i,[i]]},deserialize:t=>(t.start(),d(t,[],undefined))}],["throw",{canHandle:t=>s(t)&&a in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function l(t,e=self){e.addEventListener("message",(function o(r){if(!r||!r.data)return;const{id:s,type:n,path:h}=Object.assign({path:[]},r.data),d=(r.data.argumentList||[]).map(g);let u;try{const e=h.slice(0,-1).reduce(((t,e)=>t[e]),t),o=h.reduce(((t,e)=>t[e]),t);switch(n){case 0:u=o;break;case 1:e[h.slice(-1)[0]]=g(r.data.value),u=!0;break;case 2:u=o.apply(e,d);break;case 3:u=function(t){return Object.assign(t,{[i]:!0})}(new o(...d));break;case 4:{const{port1:e,port2:i}=new MessageChannel;l(t,i),u=function(t,e){return f.set(t,e),t}(e,[e])}break;case 5:u=void 0}}catch(t){u={value:t,[a]:0}}Promise.resolve(u).catch((t=>({value:t,[a]:0}))).then((t=>{const[i,r]=p(t);e.postMessage(Object.assign(Object.assign({},i),{id:s}),r),5===n&&(e.removeEventListener("message",o),c(e))}))})),e.start&&e.start()}function c(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function h(t){if(t)throw new Error("Proxy has been released and is not useable")}function d(t,e=[],i=function(){}){let a=!1;const s=new Proxy(i,{get(i,o){if(h(a),o===r)return()=>m(t,{type:5,path:e.map((t=>t.toString()))}).then((()=>{c(t),a=!0}));if("then"===o){if(0===e.length)return{then:()=>s};const i=m(t,{type:0,path:e.map((t=>t.toString()))}).then(g);return i.then.bind(i)}return d(t,[...e,o])},set(i,o,r){h(a);const[s,n]=p(r);return m(t,{type:1,path:[...e,o].map((t=>t.toString())),value:s},n).then(g)},apply(i,r,s){h(a);const n=e[e.length-1];if(n===o)return m(t,{type:4}).then(g);if("bind"===n)return d(t,e.slice(0,-1));const[l,c]=u(s);return m(t,{type:2,path:e.map((t=>t.toString())),argumentList:l},c).then(g)},construct(i,o){h(a);const[r,s]=u(o);return m(t,{type:3,path:e.map((t=>t.toString())),argumentList:r},s).then(g)}});return s}function u(t){const e=t.map(p);return[e.map((t=>t[0])),(i=e.map((t=>t[1])),Array.prototype.concat.apply([],i))];var i}const f=new WeakMap;function p(t){for(const[e,i]of n)if(i.canHandle(t)){const[o,r]=i.serialize(t);return[{type:3,name:e,value:o},r]}return[{type:0,value:t},f.get(t)||[]]}function g(t){switch(t.type){case 3:return n.get(t.name).deserialize(t.value);case 0:return t.value}}function m(t,e,i){return new Promise((o=>{const r=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(i){i.data&&i.data.id&&i.data.id===r&&(t.removeEventListener("message",e),o(i.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:r},e),i)}))}const x=class{constructor(t,e){var i,o,r,a,s,n;this.canvasHeight=e.canvas.height,this.canvasWidth=e.canvas.width,this.ctx=t.getContext("2d"),this.gameOverColor=null!==(i=e.text.gameOverColor)&&void 0!==i?i:"#F26463",this.foodColor=null!==(o=e.food.color)&&void 0!==o?o:"#2a2a2a",this.foodImgSrc=e.food.imgSrc,this.foodPadding=4,this.foodSize=e.food.size,this.keyPressed=[],this.snakeColor=null!==(r=e.snake.color)&&void 0!==r?r:"#2a2a2a",this.snakeSize=e.snake.snakeSize,this.textColor=null!==(a=e.text.color)&&void 0!==a?a:"#2a2a2a",this.titleColor=null!==(s=e.text.titleColor)&&void 0!==s?s:"#2a2a2a",this.subtitleColor=null!==(n=e.text.subtitleColor)&&void 0!==n?n:"#2a2a2a"}clearCanvas(){var t;null===(t=this.ctx)||void 0===t||t.clearRect(0,0,this.canvasHeight,this.canvasWidth)}drawText(t,e,i=this.textColor,o="12px courier"){const r=this.ctx;if(!r)return;r.beginPath(),r.fillStyle=i,r.font=o;const a=r.measureText(t).width;r.fillText(t,this.canvasWidth/2-Math.round(a/2),e)}drawTitlePage(t){if(!this.ctx)return;this.clearCanvas();const e=this.canvasHeight/2;this.initFood([10,20]),this.initFood([this.canvasWidth-this.foodSize-10,20]),this.drawSnake(t),this.drawText("BITE ME",55,this.titleColor,"40px courier"),this.drawText("A snake game",95,this.subtitleColor,"16px courier"),this.drawText("Press SPACE or Tap to Begin",e,this.titleColor,"14px courier"),this.drawText("Press h or tap with two",e+30,this.subtitleColor,"12px courier"),this.drawText("fingers for help",e+45,this.subtitleColor,"12px courier")}drawInstructionsPage(){this.clearCanvas(),this.ctx&&(this.drawText("HOW TO PLAY",45,void 0,"40px courier"),this.drawText("Use the arrows on your",75),this.drawText("keypad or swipe to move",90),this.drawText("the snake along.",105),this.drawText("Eat the food—a picture of my",130),this.drawText("head that my wife hates–",145),this.drawText("without crashing into the",160),this.drawText("walls or yourself!",175),this.drawText("Key Combinations: ",225,this.subtitleColor,"14px courier"),this.drawText("start: SPACE",240),this.drawText("quit: q",255),this.drawText("mute: m",270),this.drawText("Volume Down, Up: 2, 1",285))}drawSnake(t,e){const i=this.ctx;if(!i)return;e&&i.clearRect(e[0]-1,e[1]-1,this.snakeSize+2,this.snakeSize+2);const o=this.snakeColor;t.forEach((([t,e],r)=>{"string"==typeof o?(i.fillStyle=o,i.strokeStyle=o):(i.fillStyle=o[r%o.length],i.strokeStyle=o[r%o.length]),i.fillRect(t,e,this.snakeSize,this.snakeSize),i.lineWidth=1}))}drawFood([t,e]){const i=this.foodPadding,o=this.ctx;if(o)if(this.foodImg){const r=this.foodSize-i;o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(this.foodImg,t+i/2,e+i/2,r,r)}else{const r=this.foodSize/2;o.beginPath(),o.ellipse(t+r,e+r,r-2*i,r-2*i,0,0,2*Math.PI),o.fill()}}drawGameOver(t,e){const i=this.ctx;if(!i)return;this.clearCanvas();const o=this.canvasHeight/2;i.fillStyle=this.gameOverColor,this.drawText("GAME OVER",o-10,this.gameOverColor,"40px courier"),this.drawText(`Score: ${t}`,o+20,this.subtitleColor,"14px courier"),this.drawText("Press SPACE or Tap to Begin",o+60,this.titleColor,"14px courier"),e()}clearPrevPosition([t,e]){this.ctx&&this.ctx.clearRect(t,e,this.snakeSize,this.snakeSize)}clearFood(t){const e=this.ctx;if(!e)return;const i=this.snakeSize;for(let o=0;o<this.canvasWidth;o+=i)for(let r=0;r<this.canvasHeight;r+=i)t.some((([t,e])=>t===o&&e===r))||e.clearRect(o,r,i,i)}async initGame(t){if(this.foodImgSrc){const t=await fetch(this.foodImgSrc).then((t=>t.blob()));this.foodImg=await createImageBitmap(t)}this.drawTitlePage(t)}initFood(t){const[e,i]=t;this.drawFood([e,i])}};return l(x),e})()}));