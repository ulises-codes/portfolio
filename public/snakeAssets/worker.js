!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.BiteMe=e():t.BiteMe=e()}(self,(function(){return(()=>{"use strict";var t={d:(e,i)=>{for(var o in i)t.o(i,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:i[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{SnakeWorker:()=>v});const i=Symbol("Comlink.proxy"),o=Symbol("Comlink.endpoint"),a=Symbol("Comlink.releaseProxy"),s=Symbol("Comlink.thrown"),r=t=>"object"==typeof t&&null!==t||"function"==typeof t,n=new Map([["proxy",{canHandle:t=>r(t)&&t[i],serialize(t){const{port1:e,port2:i}=new MessageChannel;return h(t,e),[i,[i]]},deserialize:t=>(t.start(),d(t,[],undefined))}],["throw",{canHandle:t=>r(t)&&s in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function h(t,e=self){e.addEventListener("message",(function o(a){if(!a||!a.data)return;const{id:r,type:n,path:l}=Object.assign({path:[]},a.data),d=(a.data.argumentList||[]).map(p);let u;try{const e=l.slice(0,-1).reduce(((t,e)=>t[e]),t),o=l.reduce(((t,e)=>t[e]),t);switch(n){case 0:u=o;break;case 1:e[l.slice(-1)[0]]=p(a.data.value),u=!0;break;case 2:u=o.apply(e,d);break;case 3:u=function(t){return Object.assign(t,{[i]:!0})}(new o(...d));break;case 4:{const{port1:e,port2:i}=new MessageChannel;h(t,i),u=function(t,e){return f.set(t,e),t}(e,[e])}break;case 5:u=void 0}}catch(t){u={value:t,[s]:0}}Promise.resolve(u).catch((t=>({value:t,[s]:0}))).then((t=>{const[i,a]=m(t);e.postMessage(Object.assign(Object.assign({},i),{id:r}),a),5===n&&(e.removeEventListener("message",o),c(e))}))})),e.start&&e.start()}function c(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function l(t){if(t)throw new Error("Proxy has been released and is not useable")}function d(t,e=[],i=function(){}){let s=!1;const r=new Proxy(i,{get(i,o){if(l(s),o===a)return()=>g(t,{type:5,path:e.map((t=>t.toString()))}).then((()=>{c(t),s=!0}));if("then"===o){if(0===e.length)return{then:()=>r};const i=g(t,{type:0,path:e.map((t=>t.toString()))}).then(p);return i.then.bind(i)}return d(t,[...e,o])},set(i,o,a){l(s);const[r,n]=m(a);return g(t,{type:1,path:[...e,o].map((t=>t.toString())),value:r},n).then(p)},apply(i,a,r){l(s);const n=e[e.length-1];if(n===o)return g(t,{type:4}).then(p);if("bind"===n)return d(t,e.slice(0,-1));const[h,c]=u(r);return g(t,{type:2,path:e.map((t=>t.toString())),argumentList:h},c).then(p)},construct(i,o){l(s);const[a,r]=u(o);return g(t,{type:3,path:e.map((t=>t.toString())),argumentList:a},r).then(p)}});return r}function u(t){const e=t.map(m);return[e.map((t=>t[0])),(i=e.map((t=>t[1])),Array.prototype.concat.apply([],i))];var i}const f=new WeakMap;function m(t){for(const[e,i]of n)if(i.canHandle(t)){const[o,a]=i.serialize(t);return[{type:3,name:e,value:o},a]}return[{type:0,value:t},f.get(t)||[]]}function p(t){switch(t.type){case 3:return n.get(t.name).deserialize(t.value);case 0:return t.value}}function g(t,e,i){return new Promise((o=>{const a=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(i){i.data&&i.data.id&&i.data.id===a&&(t.removeEventListener("message",e),o(i.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:a},e),i)}))}const v=class{constructor(t,e,i){var o,a,s,r,n,h;this.advanceSnake=e,this.backgroundColor=i.canvas.backgroundColor,this.canvasHeight=i.canvas.height,this.canvasWidth=i.canvas.width,this.ctx=t.getContext("2d"),this.gameOverColor=null!==(o=i.text.gameOverColor)&&void 0!==o?o:"#F26463",this.foodColor=null!==(a=i.food.color)&&void 0!==a?a:"#2a2a2a",this.foodImgSrc=i.food.imgSrc,this.foodPadding=4,this.foodSize=i.food.size,this.keyPressed=[],this.snakeColor=null!==(s=i.snake.color)&&void 0!==s?s:"#2a2a2a",this.snakeFill=i.snake.snakeFill,this.snakeSize=i.snake.snakeSize,this.textColor=null!==(r=i.text.color)&&void 0!==r?r:"#2a2a2a",this.titleColor=null!==(n=i.text.titleColor)&&void 0!==n?n:"#2a2a2a",this.subtitleColor=null!==(h=i.text.subtitleColor)&&void 0!==h?h:"#2a2a2a"}clearCanvas(){var t;null===(t=this.ctx)||void 0===t||t.clearRect(0,0,this.canvasHeight,this.canvasWidth)}drawText(t,e,i=this.textColor,o="12px courier"){const a=this.ctx;if(!a)return;a.beginPath(),a.fillStyle=i,a.font=o;const s=a.measureText(t).width;a.fillText(t,this.canvasWidth/2-Math.round(s/2),e)}drawTitlePage(t){if(!this.ctx)return;this.clearCanvas();const e=this.canvasHeight/2;this.initFood([10,20]),this.initFood([this.canvasWidth-this.foodSize-10,20]),this.drawSnake({currentCoordinates:t}),this.drawText("BITE ME",55,this.titleColor,"40px courier"),this.drawText("A snake game",95,this.subtitleColor,"16px courier"),this.drawText("Press SPACE or Tap to Begin",e,this.titleColor,"14px courier"),this.drawText("Press h or tap with two",e+30,this.subtitleColor,"12px courier"),this.drawText("fingers for help",e+45,this.subtitleColor,"12px courier")}drawInstructionsPage(){this.clearCanvas(),this.ctx&&(this.drawText("HOW TO PLAY",45,void 0,"40px courier"),this.drawText("Use the arrows on your",75),this.drawText("keypad or swipe to move",90),this.drawText("the snake along.",105),this.drawText("Eat the food—a picture of my",130),this.drawText("head that my wife hates–",145),this.drawText("without crashing into the",160),this.drawText("walls or yourself!",175),this.drawText("Key Combinations: ",225,this.subtitleColor,"14px courier"),this.drawText("start: SPACE",240),this.drawText("quit: q",255),this.drawText("mute: m",270),this.drawText("Volume Down, Up: 2, 1",285))}drawSnake({currentCoordinates:t,newCoordinates:e}){const i=this.ctx;let o;if(o=e||t,!i)return;const a=this.snakeSize;i.strokeStyle=this.backgroundColor,i.lineWidth=2;const s=this.snakeColor;o.forEach((([t,e],o)=>{i.fillStyle="string"==typeof s?this.snakeFill:s[o%s.length],i.fillRect(t,e,a,a),i.strokeRect(t,e,a,a)}))}drawFood([t,e]){const i=this.foodPadding,o=this.ctx;if(o)if(this.foodImg){const a=this.foodSize-i;o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(this.foodImg,t+i/2,e+i/2,a,a)}else{const a=this.foodSize/2;o.beginPath(),o.ellipse(t+a,e+a,a-2*i,a-2*i,0,0,2*Math.PI),o.fill()}}drawGameOver(t,e){const i=this.ctx;if(!i)return;this.clearCanvas();const o=this.canvasHeight/2;i.fillStyle=this.gameOverColor,this.drawText("GAME OVER",o-10,this.gameOverColor,"40px courier"),this.drawText(`Score: ${t}`,o+20,this.subtitleColor,"14px courier"),this.drawText("Press SPACE or Tap to Begin",o+60,this.titleColor,"14px courier"),e(),this.stopTimer()}clearPrevPosition(t,e){this.ctx&&this.ctx.clearRect(t,e,this.snakeSize,this.snakeSize)}clearFood(t){const e=this.ctx;if(!e)return;const i=this.snakeSize;for(let o=0;o<this.canvasWidth;o+=i)for(let a=0;a<this.canvasHeight;a+=i)t.some((([t,e])=>t===o&&e===a))||e.clearRect(o,a,i,i)}eatFood(t){this.clearFood(t);const e=()=>function({snakeSize:t,canvasHeight:e,canvasWidth:i,foodSize:o}){const a=t;return[Math.floor(Math.random()*(i/a-o/(o-a)))*a,Math.floor(Math.random()*(e/a-o/(o-a)))*a]}({foodSize:this.foodSize,snakeSize:this.snakeSize,canvasWidth:this.canvasHeight,canvasHeight:this.canvasHeight});let[i,o]=e();const a=()=>{const e=Math.floor(this.foodSize/this.snakeSize),a=[];for(let t=0;t<e;t++)for(let s=0;s<e;s++)0!==t||0!==s?a.push([i+t*(this.foodSize/e),o+s*(this.foodSize/e)]):a.push([i,o]);return!a.every((([e,i])=>!t.some((([t,o])=>e===t&&i===o))))};for(;a();)[i,o]=e();return this.drawFood([i,o]),[i,o]}async initGame(t){if(this.foodImgSrc){const t=await fetch(this.foodImgSrc).then((t=>t.blob()));this.foodImg=await createImageBitmap(t)}this.drawTitlePage(t)}async initFood(t){const[e,i]=t;this.drawFood([e,i])}startTimer(){const t=()=>{this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout((async()=>{requestAnimationFrame(t),await this.advanceSnake()}),100)};this.timerId=requestAnimationFrame(t)}stopTimer(){this.timerId&&cancelAnimationFrame(this.timerId),this.timeoutId&&clearTimeout(this.timeoutId)}};return h(v),e})()}));